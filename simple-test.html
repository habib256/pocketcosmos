<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple - Diagnostic Interface</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 20px;
            line-height: 1.4;
        }
        .success { color: #00ff00; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        .info { color: #4499ff; }
        h1 { color: #ffffff; }
        .test-item { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>üöÄ Test Simple - Diagnostic Interface</h1>
    <div id="output"></div>

    <!-- Librairies externes -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.13.0/dist/tf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/matter-attractors@0.1.6/build/matter-attractors.min.js"></script>
    
    <!-- Fichiers du projet -->
    <script src="constants.js"></script>
    <script src="EventTypes.js"></script>
    <script src="controllers/EventBus.js"></script>
    <script src="models/RocketModel.js"></script>

    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-item ${type}`;
            div.innerHTML = message;
            output.appendChild(div);
            console.log(message);
        }

        function test(name, condition, successMsg, errorMsg) {
            if (condition) {
                log(`‚úÖ ${name}: ${successMsg}`, 'success');
                return true;
            } else {
                log(`‚ùå ${name}: ${errorMsg}`, 'error');
                return false;
            }
        }

        // Attendre que tout soit charg√©
        window.addEventListener('load', () => {
            setTimeout(runTests, 500); // D√©lai pour s'assurer du chargement
        });

        function runTests() {
            log('<h2>üìã R√©sultats des Tests</h2>');
            
            // Test 1: Librairies externes
            test('TensorFlow.js', typeof tf !== 'undefined', 
                `Version ${tf.version_core}`, 'Non charg√©');
            
            test('Matter.js', typeof Matter !== 'undefined', 
                'Disponible', 'Non charg√©');
            
            test('Matter Attractors', typeof MatterAttractors !== 'undefined', 
                'Plugin disponible', 'Plugin non charg√©');

            // Test 2: Constantes
            test('constants.js', typeof ROCKET !== 'undefined', 
                'Constantes charg√©es', 'Fichier non charg√©');
            
            if (typeof ROCKET !== 'undefined') {
                test('ROCKET.FUEL_MAX', typeof ROCKET.FUEL_MAX === 'number', 
                    `Valeur: ${ROCKET.FUEL_MAX}`, 'Non d√©fini');
                
                test('ROCKET.FUEL_CAPACITY absent', typeof ROCKET.FUEL_CAPACITY === 'undefined', 
                    'Ancienne constante supprim√©e', 'Ancienne constante toujours pr√©sente!');
            }

            // Test 3: EventTypes
            test('EventTypes.js', typeof window.EVENTS !== 'undefined', 
                '√âv√©nements charg√©s', 'Fichier non charg√©');

            // Test 4: Classes
            test('EventBus class', typeof EventBus === 'function', 
                'Classe disponible', 'Classe non trouv√©e');
            
            test('RocketModel class', typeof RocketModel === 'function', 
                'Classe disponible', 'Classe non trouv√©e');

            // Test 5: Instanciation
            if (typeof EventBus === 'function') {
                try {
                    const eventBus = new EventBus();
                    test('EventBus instanciation', true, 
                        'Instance cr√©√©e avec succ√®s', '');
                    
                    // Test d'√©v√©nement
                    let eventReceived = false;
                    eventBus.subscribe('TEST', () => { eventReceived = true; });
                    eventBus.emit('TEST');
                    test('EventBus fonctionnement', eventReceived, 
                        '√âv√©nement envoy√©/re√ßu', '√âchec communication');
                } catch (e) {
                    test('EventBus instanciation', false, '', `Erreur: ${e.message}`);
                }
            }

            if (typeof RocketModel === 'function') {
                try {
                    const rocket = new RocketModel();
                    test('RocketModel instanciation', true, 
                        `Fuel: ${rocket.fuel}, Sant√©: ${rocket.health}`, '');
                } catch (e) {
                    test('RocketModel instanciation', false, '', `Erreur: ${e.message}`);
                }
            }

            // Test 6: TensorFlow simple
            if (typeof tf !== 'undefined') {
                try {
                    const tensor = tf.tensor([1, 2, 3, 4]);
                    const sum = tensor.sum().dataSync()[0];
                    tensor.dispose();
                    test('TensorFlow op√©ration', sum === 10, 
                        `Calcul: 1+2+3+4 = ${sum}`, `R√©sultat incorrect: ${sum}`);
                } catch (e) {
                    test('TensorFlow op√©ration', false, '', `Erreur: ${e.message}`);
                }
            }

            // Test 7: Matter.js simple
            if (typeof Matter !== 'undefined') {
                try {
                    const engine = Matter.Engine.create();
                    const world = engine.world;
                    test('Matter.js moteur', world && Array.isArray(world.bodies), 
                        'Moteur physique initialis√©', 'Probl√®me d\'initialisation');
                } catch (e) {
                    test('Matter.js moteur', false, '', `Erreur: ${e.message}`);
                }
            }

            log('<h2>üîç Inspection des Variables Globales</h2>', 'info');
            
            // Inspecter les classes disponibles
            const classNames = Object.getOwnPropertyNames(window).filter(name => {
                const obj = window[name];
                return typeof obj === 'function' && 
                       (name.includes('Model') || name.includes('Controller') || 
                        name.includes('Bus') || name.includes('View'));
            });
            
            if (classNames.length > 0) {
                log(`üéØ Classes d√©tect√©es: ${classNames.join(', ')}`, 'info');
            } else {
                log(`‚ö†Ô∏è Aucune classe Model/Controller/Bus/View trouv√©e`, 'warning');
            }

            // Inspecter les constantes
            const constants = ['ROCKET', 'PHYSICS', 'RENDER', 'CELESTIAL_BODY'];
            constants.forEach(constName => {
                if (typeof window[constName] !== 'undefined') {
                    const keys = Object.keys(window[constName]);
                    log(`üìä ${constName}: ${keys.length} propri√©t√©s (${keys.slice(0, 3).join(', ')}...)`, 'info');
                }
            });

            log('<br><h2>‚úÖ Tests Termin√©s</h2>', 'success');
            log('V√©rifiez la console pour plus de d√©tails.', 'info');
        }

        // Gestionnaire d'erreurs global
        window.addEventListener('error', (event) => {
            log(`üö® ERREUR: ${event.message} (${event.filename}:${event.lineno})`, 'error');
        });

        console.log('üöÄ Test simple d√©marr√©...');
    </script>
</body>
</html> 