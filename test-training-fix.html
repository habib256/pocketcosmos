<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Interface d'Entra√Ænement Corrig√©e</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #4a90e2;
        }
        .success { border-left-color: #51cf66; }
        .error { border-left-color: #ff6b6b; }
        .warning { border-left-color: #ffd43b; }
        .code-block {
            background: #0d1117;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.ok { background: #51cf66; color: black; }
        .status.fail { background: #ff6b6b; color: white; }
        .status.pending { background: #ffd43b; color: black; }
    </style>
</head>
<body>
    <h1>üîß Test des Corrections Interface d'Entra√Ænement</h1>

    <div class="test-section">
        <h2>1. Test de Base - Chargement des D√©pendances</h2>
        <div id="basic-tests"></div>
    </div>

    <div class="test-section">
        <h2>2. Test des Constantes</h2>
        <div id="constants-tests"></div>
    </div>

    <div class="test-section">
        <h2>3. Test des Scripts Charg√©s</h2>
        <div id="scripts-tests"></div>
    </div>

    <div class="test-section">
        <h2>4. Test des Classes Principales</h2>
        <div id="classes-tests"></div>
    </div>

    <div class="test-section">
        <h2>5. Test d'Initialisation Compl√®te</h2>
        <div id="init-tests"></div>
        <button onclick="runFullTest()" style="background: #4a90e2; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">
            üöÄ Lancer le Test Complet
        </button>
        <div id="full-test-results"></div>
    </div>

    <!-- TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.13.0/dist/tf.min.js" onload="console.log('‚úÖ TensorFlow.js charg√©')" onerror="console.error('‚ùå Erreur chargement TensorFlow.js')"></script>
    
    <!-- Matter.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js" onload="console.log('‚úÖ Matter.js charg√©')" onerror="console.error('‚ùå Erreur chargement Matter.js')"></script>
    <script src="https://cdn.jsdelivr.net/npm/matter-attractors@0.1.6/build/matter-attractors.min.js" onload="console.log('‚úÖ Matter Attractors charg√©')" onerror="console.error('‚ùå Erreur chargement Matter Attractors')"></script>
    
    <!-- D√©pendances du projet dans l'ordre correct -->
    <script src="constants.js" onload="console.log('‚úÖ constants.js charg√©')" onerror="console.error('‚ùå Erreur chargement constants.js')"></script>
    <script src="EventTypes.js" onload="console.log('‚úÖ EventTypes.js charg√©')" onerror="console.error('‚ùå Erreur chargement EventTypes.js')"></script>
    
    <!-- Contr√¥leurs de base -->
    <script src="controllers/EventBus.js" onload="console.log('‚úÖ EventBus.js charg√©')" onerror="console.error('‚ùå Erreur chargement EventBus.js')"></script>
    
    <!-- Mod√®les dans l'ordre logique de d√©pendances -->
    <script src="models/CameraModel.js" onload="console.log('‚úÖ CameraModel.js charg√©')" onerror="console.error('‚ùå Erreur chargement CameraModel.js')"></script>
    <script src="models/ParticleModel.js" onload="console.log('‚úÖ ParticleModel.js charg√©')" onerror="console.error('‚ùå Erreur chargement ParticleModel.js')"></script>
    <script src="models/ParticleSystemModel.js" onload="console.log('‚úÖ ParticleSystemModel.js charg√©')" onerror="console.error('‚ùå Erreur chargement ParticleSystemModel.js')"></script>
    <script src="models/CelestialBodyModel.js" onload="console.log('‚úÖ CelestialBodyModel.js charg√©')" onerror="console.error('‚ùå Erreur chargement CelestialBodyModel.js')"></script>
    <script src="models/UniverseModel.js" onload="console.log('‚úÖ UniverseModel.js charg√©')" onerror="console.error('‚ùå Erreur chargement UniverseModel.js')"></script>
    <script src="models/RocketModel.js" onload="console.log('‚úÖ RocketModel.js charg√©')" onerror="console.error('‚ùå Erreur chargement RocketModel.js')"></script>

    <script>
        // Attendre que tous les scripts soient charg√©s
        window.addEventListener('load', () => {
            console.log('üîç D√©marrage des tests apr√®s chargement complet...');
            setTimeout(() => {
                testBasicDependencies();
                testConstants();
                testLoadedScripts();
                testMainClasses();
            }, 100); // Petit d√©lai pour s'assurer que tout est charg√©
        });

        function addTestResult(containerId, testName, status, details = '') {
            const container = document.getElementById(containerId);
            const statusClass = status === 'OK' ? 'ok' : status === 'FAIL' ? 'fail' : 'pending';
            
            const testDiv = document.createElement('div');
            testDiv.style.margin = '10px 0';
            testDiv.innerHTML = `
                <span class="status ${statusClass}">${status}</span>
                <strong>${testName}</strong>
                ${details ? `<br><small style="color: #888;">${details}</small>` : ''}
            `;
            container.appendChild(testDiv);
        }

        // Test 1: D√©pendances de base
        function testBasicDependencies() {
            const tests = [
                { name: 'TensorFlow.js', test: () => typeof tf !== 'undefined' && tf.version },
                { name: 'Matter.js', test: () => typeof Matter !== 'undefined' },
                { name: 'Matter Attractors', test: () => typeof MatterAttractors !== 'undefined' }
            ];

            tests.forEach(({ name, test }) => {
                try {
                    const result = test();
                    addTestResult('basic-tests', name, result ? 'OK' : 'FAIL', 
                        result && typeof result === 'object' ? JSON.stringify(result) : '');
                } catch (e) {
                    addTestResult('basic-tests', name, 'FAIL', `Erreur: ${e.message}`);
                }
            });

            // Test sp√©cial pour Matter Attractors
            try {
                Matter.use(MatterAttractors);
                addTestResult('basic-tests', 'Matter Attractors Plugin', 'OK', 'Plugin initialis√© avec succ√®s');
            } catch (e) {
                addTestResult('basic-tests', 'Matter Attractors Plugin', 'FAIL', `Erreur: ${e.message}`);
            }
        }

        // Test 2: Constantes
        function testConstants() {
            const tests = [
                { name: 'window.EVENTS', test: () => typeof window.EVENTS !== 'undefined' && window.EVENTS.AI },
                { name: 'ROCKET.FUEL_MAX', test: () => typeof ROCKET !== 'undefined' && typeof ROCKET.FUEL_MAX === 'number' },
                { name: 'PHYSICS constants', test: () => typeof PHYSICS !== 'undefined' && typeof PHYSICS.G === 'number' },
                { name: 'ROCKET.FUEL_CAPACITY inexistant', test: () => typeof ROCKET.FUEL_CAPACITY === 'undefined' }
            ];

            tests.forEach(({ name, test }) => {
                try {
                    const result = test();
                    addTestResult('constants-tests', name, result ? 'OK' : 'FAIL');
                } catch (e) {
                    addTestResult('constants-tests', name, 'FAIL', `Erreur: ${e.message}`);
                }
            });

            // V√©rification des valeurs critiques
            if (typeof ROCKET !== 'undefined') {
                addTestResult('constants-tests', 'ROCKET.FUEL_MAX value', 'OK', `Valeur: ${ROCKET.FUEL_MAX}`);
                if (typeof ROCKET.FUEL_CAPACITY !== 'undefined') {
                    addTestResult('constants-tests', 'ATTENTION', 'FAIL', 'ROCKET.FUEL_CAPACITY existe encore - devrait √™tre supprim√©');
                }
            }
        }

        // Test 3: Scripts charg√©s  
        function testLoadedScripts() {
            const scripts = document.getElementsByTagName('script');
            const loadedScripts = [];
            
            for (let script of scripts) {
                if (script.src) {
                    const filename = script.src.split('/').pop();
                    loadedScripts.push(filename);
                }
            }
            
            addTestResult('scripts-tests', 'Scripts externes d√©tect√©s', 'OK', `${loadedScripts.length} scripts trouv√©s`);
            
            // V√©rifier les scripts cl√©s
            const keyScripts = ['constants.js', 'EventTypes.js', 'EventBus.js', 'RocketModel.js'];
            keyScripts.forEach(scriptName => {
                const found = loadedScripts.some(loaded => loaded.includes(scriptName));
                addTestResult('scripts-tests', scriptName, found ? 'OK' : 'FAIL');
            });
        }

        // Test 4: Classes principales avec diagnostics plus pouss√©s
        function testMainClasses() {
            const classes = [
                'EventBus',
                'RocketModel', 
                'UniverseModel',
                'CelestialBodyModel',
                'ParticleModel',
                'ParticleSystemModel'
            ];

            // V√©rifier d'abord ce qui est disponible dans window
            console.log('üîç Inspection de window pour les classes:');
            const windowKeys = Object.getOwnPropertyNames(window).filter(key => 
                key.includes('Model') || key.includes('Bus') || key.includes('Controller')
            );
            console.log('Classes trouv√©es dans window:', windowKeys);

            classes.forEach(className => {
                try {
                    const ClassConstructor = window[className];
                    console.log(`üîç Test de ${className}:`, typeof ClassConstructor);
                    
                    if (typeof ClassConstructor === 'function') {
                        addTestResult('classes-tests', className, 'OK', 'Classe disponible');
                        
                        // Test d'instanciation simple pour EventBus uniquement (les autres ont besoin de constantes)
                        if (className === 'EventBus') {
                            try {
                                const instance = new ClassConstructor();
                                addTestResult('classes-tests', `${className} instanciation`, 'OK', 'Instance cr√©√©e avec succ√®s');
                            } catch (e) {
                                addTestResult('classes-tests', `${className} instanciation`, 'FAIL', `Erreur: ${e.message}`);
                            }
                        }
                    } else {
                        addTestResult('classes-tests', className, 'FAIL', `Type: ${typeof ClassConstructor}`);
                    }
                } catch (e) {
                    addTestResult('classes-tests', className, 'FAIL', `Erreur: ${e.message}`);
                }
            });

            // Diagnostics suppl√©mentaires
            addTestResult('classes-tests', 'Types globaux d√©tect√©s', 'OK', windowKeys.join(', ') || 'Aucun');
        }

        // Test 5: Initialisation compl√®te (asynchrone)
        async function runFullTest() {
            const resultsDiv = document.getElementById('full-test-results');
            resultsDiv.innerHTML = '<p>‚è≥ Test en cours...</p>';

            try {
                // Test EventBus
                const eventBus = new EventBus();
                addTestResult('init-tests', 'EventBus cr√©ation', 'OK');

                // Test √©v√©nement
                let eventReceived = false;
                eventBus.subscribe('TEST_EVENT', () => { eventReceived = true; });
                eventBus.emit('TEST_EVENT');
                addTestResult('init-tests', 'EventBus fonctionnement', eventReceived ? 'OK' : 'FAIL');

                // Test TensorFlow simple
                const tensor = tf.tensor2d([[1, 2], [3, 4]]);
                const shape = tensor.shape;
                tensor.dispose();
                addTestResult('init-tests', 'TensorFlow op√©ration', 'OK', `Shape: [${shape.join(', ')}]`);

                // Test Matter.js simple
                const engine = Matter.Engine.create();
                const body = Matter.Bodies.rectangle(0, 0, 10, 10);
                addTestResult('init-tests', 'Matter.js moteur', 'OK');

                // Test instanciation RocketModel si disponible
                if (typeof RocketModel === 'function') {
                    const rocket = new RocketModel();
                    addTestResult('init-tests', 'RocketModel instanciation', 'OK', `Fuel: ${rocket.fuel}`);
                }

                resultsDiv.innerHTML = '<p style="color: #51cf66;">‚úÖ Test complet termin√© avec succ√®s!</p>';

            } catch (error) {
                addTestResult('init-tests', 'Test complet', 'FAIL', error.message);
                resultsDiv.innerHTML = `<p style="color: #ff6b6b;">‚ùå Erreur: ${error.message}</p>`;
            }
        }

        // Gestionnaire d'erreurs global am√©lior√©
        window.addEventListener('error', (event) => {
            console.error('üö® Erreur JavaScript d√©tect√©e:', event.error);
            const errorDiv = document.createElement('div');
            errorDiv.className = 'test-section error';
            errorDiv.innerHTML = `
                <h3>üö® Erreur JavaScript D√©tect√©e</h3>
                <div class="code-block">Erreur: ${event.error?.message || event.message}
Fichier: ${event.filename}
Ligne: ${event.lineno}
Stack: ${event.error?.stack || 'N/A'}</div>
            `;
            document.body.appendChild(errorDiv);
        });

        // Log de d√©bogage pour voir quand les scripts se chargent
        console.log('üöÄ Script de test d√©marr√©');
    </script>
</body>
</html> 